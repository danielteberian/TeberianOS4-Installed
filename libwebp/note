This should be recompiled with added support for optionals.
